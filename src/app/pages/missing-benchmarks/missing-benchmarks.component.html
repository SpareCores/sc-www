<div class="w-full bg-primary">
  <div class="content pt-16 pb-16 text-white flex flex-col gap-6">
    <app-breadcrumbs [segments]="breadcrumbs"></app-breadcrumbs>
    <h1 class="text-4xl font-bold">Benchmark Completion Report</h1>
    <div class="text-white text-xl pr-16">
      Although we try hard, we were not able to start some instances for
      hardware inspections and to run our benchmark workloads. Sometimes this is
      due to the server not being available (temporarily or permanently out of
      stock, not GA, etc.), being limited by vendor and account quotas, or facing
      technical issues (e.g. API rate limiting). You can find a breakdown of
      these servers by vendor below:
    </div>

    <table class="items_table">
      <thead>
        <tr>
          <th class="py-4 px-4">
            <div class="flex gap-1 whitespace-nowrap">VENDOR</div>
          </th>
          <th class="py-4 px-4">
            <div class="flex justify-end whitespace-nowrap">IDENTIFIED SERVERS</div>
          </th>
          <th colspan="2" class="border-l border-gray-600 px-12 py-4">
            <div class="flex justify-center whitespace-nowrap">INACTIVE SERVERS</div>
          </th>
          <th colspan="2" class="border-l border-gray-600 px-12 py-4">
            <div class="flex justify-center whitespace-nowrap">ACTIVE SERVERS</div>
          </th>
          <th colspan="2" class="border-l border-gray-600 px-12 py-4">
            <div class="flex justify-center whitespace-nowrap">EVALUATED ACTIVE SERVERS</div>
          </th>
          <th colspan="2" class="border-l border-gray-600 px-12 py-4">
            <div class="flex justify-center whitespace-nowrap">MISSING ACTIVE SERVERS</div>
          </th>
        </tr>
      </thead>
      <tbody>
        @for (vendor of vendors; track vendor.vendor_id) {
          <tr>
            <td class="pl-3 pr-2 py-3">
              <div class="flex gap-1">
                {{ vendor.name }}
              </div>
            </td>
            <td class="px-4">
              <div class="flex justify-end">
                {{ vendor.servers }}
              </div>
            </td>
            <td class="border-l border-gray-600 w-16 pl-6 pr-1">
              <div class="flex justify-end">
                {{ vendor.inactive_count }}
              </div>
            </td>
            <td class="w-20 pl-1 pr-6">
              <div class="flex justify-end">
                {{ (vendor.inactive_count / vendor.servers * 100).toFixed(2) }}%
              </div>
            </td>
            <td class="border-l border-gray-600 w-16 pl-6 pr-1">
              <div class="flex justify-end">
                {{ vendor.active_servers }}
              </div>
            </td>
            <td class="w-20 pl-1 pr-6">
              <div class="flex justify-end">
                {{ (vendor.active_servers / vendor.servers * 100).toFixed(2) }}%
              </div>
            </td>
            <td class="border-l border-gray-600 w-16 pl-6 pr-1">
              <div class="flex justify-end">
                {{ vendor.evaluated_active_servers }}
              </div>
            </td>
            <td class="w-20 pl-1 pr-6">
              <div class="flex justify-end">
                {{ (vendor.evaluated_active_servers / vendor.active_servers * 100).toFixed(2) }}%
              </div>
            </td>
            <td class="border-l border-gray-600 w-16 pl-6 pr-1">
              <div class="flex justify-end">
                {{ vendor.technical_issues_count }}
              </div>
            </td>
            <td class="w-20 pl-1 pr-6">
              <div class="flex justify-end">
                {{ (vendor.technical_issues_count / vendor.active_servers * 100).toFixed(2) }}%
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>

    <div class="text-white text-xl pr-16">
      Detailed list of the servers that are missing benchmarks, including the
      likely root cause for the missing data:
    </div>

    @for (vendor of vendors; track vendor.vendor_id) {
      <div>
        @if (vendor.missing_servers?.length) {
          <div class="flex flex-col">
            <h2
              class="text-3xl mb-2 flex items-center cursor-pointer hover:opacity-80 transition-opacity"
              (click)="toggleVendor(vendor.id)"
            >
              <lucide-icon
                [name]="
                  isVendorExpanded(vendor.id) ? 'chevron-down' : 'chevron-right'
                "
                class="h-8 w-8 flex-shrink-0"
              ></lucide-icon>
              <span
                >{{ vendor.name }} ({{ vendor.servers }} servers:
                {{ vendor.inactive_count }} inactive,
                {{ vendor.technical_issues_count }} technical/quota
                issues)</span
              >
            </h2>
            @if (isVendorExpanded(vendor.id)) {
              <table class="items_table ml-8 mt-2">
                <thead>
                  <tr>
                    <th class="pl-3 pr-2 py-3">
                      <div class="flex gap-1">SERVER</div>
                    </th>
                    <th class="pl-3 pr-2 py-3">
                      <div class="flex gap-1">MISSING REASON</div>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  @for (
                    server of vendor.missing_servers;
                    track server.vendor_id + "_" + server.server_id
                  ) {
                    <tr>
                      <td class="pl-3 pr-2 py-3">
                        <div class="pl-2 flex gap-1">
                          {{ server.name }}
                        </div>
                      </td>
                      <td class="pl-3 pr-2">
                        <div class="flex gap-1">
                          {{ server.reason }}
                        </div>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            }
          </div>
        }
      </div>
    }
  </div>
</div>
